<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyBatis ResultMap 解析</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: #f5f7f9;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        .content {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
        }
        .explanation, .visualization {
            flex: 1;
            min-width: 300px;
            padding: 20px;
        }
        .explanation {
            border-right: 1px solid #eee;
        }
        h2 {
            color: #6a11cb;
            margin: 20px 0 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        h3 {
            color: #2575fc;
            margin: 15px 0 10px;
        }
        p {
            margin-bottom: 15px;
        }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Consolas', monospace;
        }
        .sql-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .sql-table th, .sql-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        .sql-table th {
            background-color: #f2f2f2;
        }
        .sql-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .teacher-box {
            background: #6a11cb;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .student-list {
            margin-left: 30px;
        }
        .student-item {
            background: #2575fc;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .arrow {
            display: block;
            text-align: center;
            font-size: 24px;
            margin: 10px 0;
        }
        .highlight {
            background: #fff8e1;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
        }
        .note {
            background: #e3f2fd;
            padding: 15px;
            border-left: 4px solid #2196f3;
            margin: 20px 0;
        }
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            .explanation {
                border-right: none;
                border-bottom: 1px solid #eee;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MyBatis ResultMap 集合映射解析</h1>
            <div class="subtitle">理解 &lt;collection&gt; 如何将多条记录分组为对象列表</div>
        </header>
        
        <div class="content">
            <div class="explanation">
                <h2>问题分析</h2>
                <p>您的疑问是：为什么SQL查询返回多条记录，但MyBatis的ResultMap能够将同一个老师对应的学生放在同一个列表中？</p>
                
                <h2>原理解析</h2>
                <p>MyBatis的 <span class="highlight">&lt;collection&gt;</span> 元素具有自动分组功能。当处理结果集时，MyBatis会：</p>
                
                <ol>
                    <li>遍历SQL返回的每一行数据</li>
                    <li>根据ID识别相同的主对象（Teacher）</li>
                    <li>将关联对象（Student）收集到主对象的集合属性中</li>
                    <li>自动处理重复的主对象，只创建一个实例</li>
                </ol>
                
                <h2>SQL查询示例</h2>
                <p>假设您的查询返回以下数据：</p>
                
                <table class="sql-table">
                    <tr>
                        <th>tid</th>
                        <th>tname</th>
                        <th>sid</th>
                        <th>sname</th>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>张老师</td>
                        <td>101</td>
                        <td>学生A</td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>张老师</td>
                        <td>102</td>
                        <td>学生B</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>李老师</td>
                        <td>103</td>
                        <td>学生C</td>
                    </tr>
                </table>
                
                <h2>ResultMap 配置</h2>
                <div class="code-block">
&lt;resultMap id="studentTeacher" type="Teacher"&gt;
    &lt;result property="id" column="tid"/&gt;
    &lt;result property="name" column="tname"/&gt;
    &lt;collection property="students" ofType="Student"&gt;
        &lt;result property="id" column="sid"/&gt;
        &lt;result property="name" column="sname"/&gt;
    &lt;/collection&gt;
&lt;/resultMap&gt;
                </div>
                
                <div class="note">
                    <strong>关键点：</strong> MyBatis通过识别相同的主键(tid)来判断是否为同一个Teacher对象，然后将对应的学生数据收集到该Teacher的students集合中。
                </div>
            </div>
            
            <div class="visualization">
                <h2>映射过程可视化</h2>
                
                <h3>SQL查询结果（3条记录）</h3>
                <p>数据库返回3行数据，包含2位老师和3个学生</p>
                
                <div class="arrow">↓</div>
                
                <h3>MyBatis处理后的结果（2个对象）</h3>
                
                <div class="teacher-box">
                    <strong>Teacher对象</strong><br>
                    ID: 1, Name: 张老师
                    <div class="student-list">
                        <div class="student-item">
                            <strong>Student对象</strong><br>
                            ID: 101, Name: 学生A
                        </div>
                        <div class="student-item">
                            <strong>Student对象</strong><br>
                            ID: 102, Name: 学生B
                        </div>
                    </div>
                </div>
                
                <div class="teacher-box">
                    <strong>Teacher对象</strong><br>
                    ID: 2, Name: 李老师
                    <div class="student-list">
                        <div class="student-item">
                            <strong>Student对象</strong><br>
                            ID: 103, Name: 学生C
                        </div>
                    </div>
                </div>
                
                <div class="arrow">↓</div>
                
                <h3>最终Java对象结构</h3>
                <div class="code-block">
List&lt;Teacher&gt; teachers = [
    {
        id: 1,
        name: "张老师",
        students: [
            {id: 101, name: "学生A"},
            {id: 102, name: "学生B"}
        ]
    },
    {
        id: 2,
        name: "李老师",
        students: [
            {id: 103, name: "学生C"}
        ]
    }
]
                </div>
                
                <h2>工作机制总结</h2>
                <p>MyBatis的 <span class="highlight">&lt;collection&gt;</span> 元素：</p>
                <ul>
                    <li>自动识别相同ID的主对象</li>
                    <li>将关联的子对象收集到主对象的集合中</li>
                    <li>无需手动编写分组逻辑</li>
                    <li>极大简化了一对多关系的映射处理</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>