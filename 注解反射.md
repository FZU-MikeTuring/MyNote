# 注解反射

## 元注解

> @Target用于描述注解的 使用范围(类，方法，)
>
> @Retention表示需要在什么级别保存该注释信息
>
> source<class<runtime
>
> @Document说明该注解被包含在javadoc中
>
> @Inherited说明子类可以继承父类中的注解

## 自定义注解

```java
@Target(value={ElementType.TYPE,ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
@interface MyAnnotation{
    String value();
    String name() default "";
    int age() default 0;
    int id() default -1;
    String[] schools() default{"福州大学","清华大学"};
}
//默认对value赋值时可以省略前面的"value="
```

## Reflection反射

### 获得类对象的 方法

```java
//方法一
Class c1=Class.forName("path");
//方法二
User user=new User();
Class c2=user.getClass();
//方法三
Class c3=User.class
```

### 哪些有class对象？

- 类
- 接口
- 一维数组
- 二维数组
- 注解
- 枚举
- 基本数据类型
- void
- Class



### 类加载内存分析

- 加载
- 链接
- 初始化



## 通过反射能做那些事？

```java
Class c=Object.Class;
```


### 获取类的名字

```java
c.getName();
```

### 获取类的属性

```java
c.getDeclaredFields();
```

### 获取指定属性的值

```java
c.getDeclaredField("name");
```

### 获得类的方法

```java
c.getDeclaredMethods("方法名",String.class,int.class);//该方法的名字以及其参数对应的类
```

### 获取指定方法

```java
//参数：方法名，该方法的参数的Class对象
c.getMethod("setName",String.class);
```

### 获取类的构造器

```java
c.getDeclaredConstructor(String.class,int.class,int.class);//该构造器的参数的Class
```



### 创建一个对象

```java
User user=(User)c.newInstance();
```



### 通过含参构造器创建一个对象

```java
Constructor constructor=c.getDeclaredConstructor(String.class,int.class,int.class);
User user=(User)constructor.newInstance("whn",12,60);
```



### 通过反射执行某个类的方法

```java
User user=new User();
Method setName=c.getDeclaredMethod("setName",String.class);
setName.invoke(user,"whn");
System.out.println(user.getName());//输出结果为:whn
```



### 通过反射设置某个类的属性

```java
User user1=(User)c1.newInstance();
Field name=c1.getDeclaredField("name");
name.setAccessible(true);//如果是私有属性，需要显示的关闭安全检测，如果是私有方法也需要有此步
name.set(user1,"whn");
System.out.println("name="+user1.getName());
```

### Annotation And Reflection

```java
package com.tur.Reflection;

import java.lang.annotation.*;
import java.lang.reflect.Field;

public class AnnotationAndReflection {
    public static void main(String[] args) throws NoSuchFieldException {
        Class c=Person.class;
        Annotation[] a= c.getAnnotations();
        for(Annotation a1: a) {
            System.out.println(a1);
        }
        MyTypeAnnotation myTypeAnnotation=(MyTypeAnnotation) c.getAnnotation(MyTypeAnnotation.class);
        String value=myTypeAnnotation.columenType();
        System.out.println(value);

        Field name=c.getDeclaredField("name");
        //通过反射得到的属性来获取该属性注解的信息
        MyFieldAnnotation myFieldAnnotation=name.getAnnotation(MyFieldAnnotation.class);
        String columnName=myFieldAnnotation.columnName();
        String columnType=myFieldAnnotation.columnType();
        System.out.println("columnName="+columnName+",columnType="+columnType);
    }
}

@MyTypeAnnotation(columenType = "Person")
class Person{

    @MyFieldAnnotation(columnName = "name",columnType = "String")
    private String name;
    @MyFieldAnnotation(columnName = "age",columnType = "int")
    private int age;
    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }
    public int getAge() {return age;}
}

@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@interface MyTypeAnnotation{
    String columenType();
}

@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
@interface MyFieldAnnotation{
    String columnName() default "";
    String columnType() default "";
}

```

